# django_project

***Всем привет! Меня зовут Кристина Рожкова. Я учусь в online школе [sky.pro](https://sky.pro/#giftpopup) на
phyton-разработчика. Данный проект является выполнением домашнего задания по изучению Django.***

### Домашнее задание №1

**Контекст:** Будет создаваться проект интернет-магазина, который будет дорабатываться на каждом уроке в течение всего
курса.

**Задание 1. Настройка проекта:**

- Создайте новую директорию для проекта и настройте виртуальное окружение.
- Инициализируйте новый проект Django внутри этой директории.

**Задание 2. Создание и настройка приложения:**

- Создайте новое приложение под названием catalog в вашем проекте.
- Зарегистрируйте приложение в настройках проекта.
- Настройте маршрутизацию для нового приложения, добавив соответствующие URL-адреса.

**Задание 3. Создание шаблонов:**

- Подготовьте два HTML-шаблона: для домашней страницы и для страницы с контактной информацией.
- Для стилизации страниц используйте Bootstrap.

**Задание 4. Реализация контроллеров:**

- Создайте контроллер для отображения домашней страницы.
- Создайте контроллер для отображения страницы с контактной информацией.
- Настройте маршрутизацию для этих контроллеров.

***Дополнительное задание:**

- Реализуйте форму обратной связи на странице контактов.
- Настройте обработку данных формы в контроллере, чтобы отображать сообщение об успешной отправке данных.

### Домашнее задание №2

**Контекст:** Вы продолжаете работу над проектом. Вам предстоит подключить PostgreSQL к проекту, создать и настроить
модели Product и Category, перенести их в базу данных с помощью миграций, зарегистрировать и настроить модели в админке,
наполнить базу данных через Django shell, создать фикстуры для моделей и реализовать кастомную команду для добавления
тестовых данных.

**Задание 1.**

Подключите СУБД PostgreSQL для работы в проекте.

- Создайте базу данных в ручном режиме.
- Внесите изменения в настройки подключения в файле settings.py.

**Задание 2.**

В приложении каталога создайте модели Product и Category и опишите для них базовые настройки.

Описание моделей:

- Product:
    - наименование,
    - описание,
    - изображение,
    - категория,
    - цена за покупку,
    - дата создания,
    - дата последнего изменения.
- Category:
    - наименование,
    - описание.

Поля «Дата создания» и «Дата последнего изменения» стали стандартом для моделей.
Их общепринятые названия — created_at и updated_at соответственно.

**Задание 3.**

Перенесите отображение моделей в базу данных с помощью инструмента миграций. Для этого:

- создайте миграции для новых моделей;
- примените миграции.

Важно сохранять всю историю миграций проекта для сохранения целостности базы данных проекта.
Не забудьте добавить все выполненные миграции в коммит, а затем отправить в удаленный репозиторий на GitHub.

**Задание 4.**

- Создайте суперпользователя.
- Зарегистрируйте модели Product и Category в админке.
- Настройте отображение для моделей:
    - Для Category выведите id и name в списке.
    - Для Product выведите id, name, price и category в списке.
    - Настройте фильтрацию продуктов по категории.
    - Настройте поиск по полям name и description.

**Задание 5.**

Через инструмент shell заполните список категорий, а также выберите список категорий, применив произвольные
рассмотренные фильтры.

- Войдите в Django shell.
- Создайте несколько категорий и продуктов.
- Выполните следующие запросы:
    - Получите все категории.
    - Получите все продукты.
    - Найдите все продукты в определенной категории.
    - Обновите цену для определенного продукта.
    - Удалите продукт.

В качестве решения отправьте наставнику для проверки скриншоты выполнения команд.

**Задание 6.**

Сформируйте фикстуры для моделей Category и Product.

**Задание 7.**

- Создайте кастомную команду для добавления тестовых продуктов.
- В команде удалите все существующие данные из базы перед добавлением новых продуктов.

Этот пункт можно реализовать в связке с инструментом работы с фикстурами, можно описать вставку данных отдельными
запросами.

***Дополнительное задание.**

- Добавьте в контроллер отображения главной страницы выборку последних 5 созданных продуктов и выведите их в консоль.
- Создайте модель для хранения контактных данных и выведите данные, заполненные через админку, на страницу с контактами.

### Домашнее задание №3

**Контекст:** Теперь необходимо придать динамики приложению, а также сделать страницы более привлекательными.

**Задание 1.**

Создайте новый контроллер и шаблон для отображения страницы с подробной информацией о товаре. На этой странице должна
быть показана вся информация о товаре.

**Задание 2.**

Добавьте в шаблон главной страницы код для отображения списка товаров с помощью цикла. Чтобы карточки товаров выглядели
одинаково, обрежьте отображаемое описание до первых 100 символов.

**Задание 3.**

Из-за увеличения количества шаблонов возникает много повторяющегося кода. Выделите общий (базовый) шаблон, который будет
включать общие элементы страницы, такие как шапка, подвал и стили. Также создайте подшаблон для главного меню, который
можно будет включать в другие шаблоны.

***Дополнительное задание.**

- Реализуйте страницу с формой, которая позволит пользователю добавлять новые товары. Обработайте ввод данных и
  сохраните новый товар в базу данных.
- Добавьте функциональность для постраничного вывода списка товаров на главной странице. Убедитесь, что пользователи
  могут легко переходить между страницами списка товаров.

### Домашнее задание №4

**Контекст:** Настало время провести рефакторинг веб-приложения и добавить функциональность для улучшения SEO сайта
путем создания раздела с блогом. Блог поможет улучшить видимость сайта в поисковых системах и привлечь больше
посетителей за счет публикации качественного контента.

**Задание 1.**

Переведите имеющиеся в проекте контроллеры с FBV на CBV.

**Задание 2.**

Создайте новое приложение для блога и добавьте его в файл settings.py.

Создайте новую модель блоговой записи со следующими полями:

- заголовок,
- содержимое,
- превью (изображение),
- дата создания,
- признак публикации (булевое поле),
- количество просмотров.

Для работы с блогом реализуйте полный CRUD для новой модели, используя CBV.

**Задание 3.**

Модифицируйте вывод и обработку запросов, добавив следующую логику на уровне контроллеров:

- Увеличение счетчика просмотров: при открытии отдельной статьи увеличивать счетчик просмотров.
- Фильтрация опубликованных статей: выводить в список статей только те, которые имеют положительный признак публикации.
- Перенаправление после редактирования: после успешного редактирования записи необходимо перенаправлять пользователя на
  просмотр этой статьи.

***Дополнительное задание**

Когда статья достигает 100 просмотров, отправляйте себе на почту поздравление с достижением.

### Домашнее задание №5

**Контекст: Популярность магазина значительно выросла. В связи с этим продакт-менеджер предложил добавить возможность
пользователям заполнять карточки продуктов и при этом расширить функционал веб-приложения.**

**Задание 1.**

Реализуйте механизм CRUD для модели продуктов, используя модуль django.forms. При этом необходимо обезопасить сайт от
спама и не разрешать присваивать продуктам названия и добавлять в описание слова, которые включены в список запрещенных
слов.

Реализуйте валидацию формы, чтобы проверять отсутствие этих слов (в любом регистре) в данных полях.

Запрещенные слова, которые нельзя использовать в названиях и описаниях продуктов:

казино, криптовалюта, крипта, биржа, дешево, бесплатно, обман, полиция, радар.

**Задание 2.**

Добавьте кастомную валидацию для поля price в форме создания и редактирования продуктов. Валидация должна проверять, что
цена продукта не может быть отрицательной. Реализуйте это с использованием метода clean_price в форме. Если цена введена
неправильно, отобразите соответствующее сообщение пользователю.

**Задание 3.**

Добавьте стилизацию форм для продуктов, используя метод __init__. Убедитесь, что формы соответствуют общей стилистике
платформы.

***Дополнительное задание.**
Реализуйте механизм, при котором пользователи могут загружать изображения продуктов. Добавьте валидацию для поля
загрузки изображения, чтобы проверить формат и размер загружаемого файла. Убедитесь, что загружаемые файлы имеют формат
JPEG или PNG и не превышают размер 5 МБ.

### Домашнее задание №6

**Контекст: С ростом сервиса часто приходят боты, которые нацелены на то, чтобы заполнить своими спам-сообщениями любую
открытую форму для заполнения. Именно поэтому создаются проверки на робота или устанавливаются ограничения на важные
формы, чтобы сделать их доступными только для зарегистрированных пользователей.**
**Для сервиса интернет-магазина необходимо реализовать функцию аутентификации пользователей, чтобы боты не могли
вмешиваться в работу сервиса.**

**Задание 1.**

Создайте новое приложение для работы с пользователями в вашем проекте Django.

Определите модель пользователя с использованием AbstractUser, задав электронную почту как поле для авторизации.

Добавьте дополнительные поля в модель пользователя:

- аватар (изображение),
- номер телефона,
- страна.

**Задание 2.**

В сервисе реализуйте функцию аутентификации, а именно:

Регистрация пользователя:

- Создайте форму для регистрации пользователя с полями электронной почты и пароля.
- Добавьте логику регистрации в представлении, позволяя пользователю создать учетную запись.
- Реализуйте отправку приветственного письма пользователю после регистрации.

Авторизация пользователя:

- Настройте форму и представление для авторизации пользователя по электронной почте и паролю.

**Задание 3.**

Закройте доступ к страницам, связанным с управлением продуктами, для анонимных пользователей.
Убедитесь, что только авторизованные пользователи могут просматривать, создавать, изменять и удалять продукты.
Общедоступной должна остаться только страница просмотра списка товаров.

***Дополнительное задание.**

Добавьте интерфейс редактирования профиля пользователя.

### Домашнее задание №7

**Контекст: Из-за наплыва пользователей стало появляться много продуктов, которые администратор не успевает
обрабатывать. Поэтому возникла необходимость проводить ручное модерирование продуктов, которые добавляются на платформу.
Для этих целей было решено нанять модераторов.**

**Задание 1.**

Создайте группу для роли «Модератор продуктов» и настройте необходимые разрешения.

___
Подготовительные шаги:

Добавьте к модели продукта поле, определяющее статус публикации. Это может быть BooleanField со значением False по
умолчанию или CharField с указанием возможных значений (choices). Значение по умолчанию должно указывать на статус, не
предполагающий публикацию продукта.

Не забудьте сохранить группы фикстурой или реализовать кастомную команду для создания групп для отправки наставнику на
проверку.
___
1. Добавьте кастомные права к модели продукта. can_unpublish_product — может отменять публикацию продукта

2. Создайте группу «Модератор продуктов» и назначьте ей следующие права:
   - Разрешение can_unpublish_product.
   - Разрешение на удаление любого продукта.

3. Настройте проверки в контроллерах и шаблонах, чтобы использовать эти права.
Проверьте наличие прав у пользователя при попытке отменить публикацию или удалить продукт.

**Задание 2.**
Реализуйте решение, которое проверяет, что редактирование и удаление продукта доступно только его владельцу.

1. Добавьте поле владельца (owner) к модели продукта.
Поле должно быть связано с моделью пользователя через ForeignKey.

2. Настройте создание продукта таким образом, чтобы автоматически привязывать продукт к авторизованному пользователю.
При создании нового продукта поле owner должно автоматически заполняться текущим авторизованным пользователем.

3. Настройте проверки в контроллерах, чтобы только владелец мог редактировать и удалять продукт.
Реализуйте проверку прав доступа в представлениях для редактирования и удаления продуктов, чтобы только владелец мог
выполнять эти действия.
Удалять продукты должен не только владелец, но и модератор.
Обновите шаблоны, чтобы кнопка редактирования и удаления отображалась только для владельца продукта.

***Дополнительное задание**
Создайте группу для роли «Контент-менеджер». Пользователи, которые включены в эту группу, могут управлять публикациями
в блоге. Реализуйте проверки, чтобы обычный пользователь или модератор из другого отдела не мог изменять раздел блога.

___

## Установка

1. Клонирование репозитория по [HTTPS](https://github.com/Kristina-Rozhkova/django_project.git)
2. Все зависимости описаны в файле pyproject.toml, все исключения добавлены в .gitignore

---

## Структура проекта

```
djangoproject/
├── manage.py
├── .env.sample
├── .gitignore
├── catalog.json
├── static/
├── media/
├── config/
│   ├── __init__.py
│   ├── asgi.py
│   ├── settings.py
│   ├── urls.py
│   └── wsgi.py
├── catalog/
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── models.py
│   ├── tests.py
│   ├── urls.py
│   ├── views.py
│   ├── forms.py
│   ├── management/
│   │   ├── __init__.py
│   │   ├── commands/
│   │   │   ├── __init__.py
│   │   │   └── add_products.py
│   ├── migrations/
│   ├── templates/
│   │   ├── catalog/
│   │   │   ├── base.html
│   │   │   ├── product_list.html
│   │   │   ├── contact_form.html
│   │   │   ├── product_detail.html
│   │   │   ├── product_form.html
│   │   │   └── product_confirm_delete.html
│   │   ├── includes/
│   │   │   ├── nav_menu.html
│   │   │   ├── footer.html
│   │   │   └── pagination.html
│   ├── templatetags/
│   └── └── my_tags.py
├── blog/
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── models.py
│   ├── tests.py
│   ├── urls.py
│   ├── views.py
│   ├── migrations/
│   ├── templates/
│   │   ├── blog/
│   │   │   ├── base.html
│   │   │   ├── article_list.html
│   │   │   ├── article_detail.html
│   │   │   ├── article_form.html
│   │   │   ├── article_confirm_delete.html
│   │   │   ├── includes/
│   │   │   │   ├── nav_menu.html
│   │   │   │   ├── footer.html
│   └── └── └── └── pagination.html
│   ├── templatetags/
│   │   └── my_tags.py
├── users/
│   ├── __init__.py
│   ├── admin.py
│   ├── apps.py
│   ├── forms.py
│   ├── models.py
│   ├── tests.py
│   ├── urls.py
│   ├── views.py
│   ├── migrations/
│   ├── templates/
│   │   ├── login.html
│   │   ├── users/
│   │   │   ├── profile.html
└── └── └── └── user_form.html

```

___

## Использование

Пакет config содержит модули с настройками для работы с приложением catalog.

Пакет catalog содержит следующие пакеты и модули:

- [templates](catalog/templates/catalog) - директория, содержащая веб-страницы
- [migrations](catalog/migrations) - миграции приложения
- [management](catalog/management/commands) - реализация кастомных команд
- [my_tags.py](catalog/templatetags/my_tags.py)
- [admin.py](catalog/admin.py)
- [apps.py](catalog/apps.py)
- [models.py](catalog/models.py)
- [views.py](catalog/views.py)
- [tests.py](catalog/tests.py)
- [urls.py](catalog/urls.py)
- [forms.py](catalog/forms.py)

Пакет blog содержит следующие пакеты и модули:

- [templates](blog/templates/blog) - директория, содержащая веб-страницы
- [migrations](blog/migrations) - миграции приложения
- [my_tags.py](blog/templatetags/my_tags.py)
- [admin.py](blog/admin.py)
- [apps.py](blog/apps.py)
- [models.py](blog/models.py)
- [views.py](blog/views.py)
- [tests.py](blog/tests.py)
- [urls.py](blog/urls.py)

Пакет users содержит следующие пакеты и модули:

- [templates](users/templates) - директория, содержащая веб-страницы
- [migrations](users/migrations) - миграции приложения
- [admin.py](users/admin.py)
- [apps.py](users/apps.py)
- [forms.py](users/forms.py)
- [models.py](users/models.py)
- [views.py](users/views.py)
- [tests.py](users/tests.py)
- [urls.py](users/urls.py)

---

## Содержание модулей

1. Приложение [catalog](catalog).

   Реализация работы интернет-магазина каталога товаров:
    - [add_products](catalog/management/commands)
      Кастомные команды Django для добавления тестовых продуктов. Реализуется через загрузку данных
      из [catalog.json](catalog.json) с предварительным очищением базы данных.
    - [base.html](catalog/templates/catalog/base.html). Базовый шаблон веб-страниц.
    - [nav_menu.html](catalog/templates/includes/nav_menu.html). Подшаблон навигации, включенный в базовый шаблон.
    - [footer.html](catalog/templates/includes/footer.html). Подшаблон подвала, включенный в базовый шаблон.
    - [product_list.html](catalog/templates/catalog/product_list.html). Шаблон главной страницы. Отображает список
      последних добавленных товаров.
    - [product_detail.html](catalog/templates/catalog/product_detail.html). Шаблон для просмотра детальной информации
      продукта.
    - [pagination.html](catalog/templates/includes/pagination.html). Подшаблон плагинации, включенный в шаблон главной
      страницы.
    - [contact_form.html](catalog/templates/catalog/contact_form.html). Шаблон страницы контактов. Включает форму
      обратной связи.
    - [product_form.html](catalog/templates/catalog/product_form.html). Шаблон с формой добавления нового продукта
      в базу данных.
    - [product_confirm_delete.html](catalog/templates/catalog/product_confirm_delete.html). Шаблон для удаления продукта
      из базы данных.
    - [my_tags.py](catalog/templatetags/my_tags.py). Кастомный фильтр для обработки путей к медиафайлам Django.
    - [admin.py](catalog/admin.py). Конфигурация админ-панели Django. Регистрация моделей (Product, Category, Contact) и
      кастомизация их отображения.
    - [apps.py](catalog/apps.py). Конфигурация приложения catalog. Определяет имя приложения и метаданные.
    - [models.py](catalog/models.py). Модели данных: Product (товары), Category (категории), Contact (контактные
      данные).
    - [tests.py](catalog/tests.py). Тесты для проверки функциональности приложения (моделей, представлений).
    - [urls.py](catalog/urls.py). Маршруты приложения: catalog/ (главная), contacts/ (контакты).
    - [views.py](catalog/views.py). Реализован полный CRUD. На главной странице список товаров отсортирован по дате
      создания в порядке убывания. При редактировании информации о товаре, пользователя выбрасывает на страницу
      детального просмотра этого товара. При заполнении формы контактной информации, в консоль выводится сообщение о
      заполненных данных.
    - [forms.py](catalog/forms.py). Создана форма для модели Product c валидацией полей name, description на проверку
      наличия запрещенных слов и image на проверку расширения и размера файла. Также реализован миксин для стилизации
      формы.
2. Директория [config](config)
    - [asgi.py](config/asgi.py). Конфигурация ASGI для запуска приложения с асинхронными серверами.
    - [settings.py](config/settings.py). Настройки проекта: база данных psql, шаблоны, статические файлы, подключённые
      приложения.
    - [urls.py](config/urls.py). Корневые маршруты проекта. Подключает URL-адреса приложения catalog.
    - [wsgi.py](config/wsgi.py). Конфигурация WSGI для запуска приложения с синхронными серверами.
3. Приложение [blog](blog).

   Реализация работы блога:
    - [base.html](blog/templates/blog/base.html). Базовый шаблон веб-страниц.
    - [nav_menu.html](blog/templates/blog/includes/nav_menu.html). Подшаблон навигации, включенный в базовый шаблон.
    - [footer.html](blog/templates/blog/includes/footer.html). Подшаблон подвала, включенный в базовый шаблон.
    - [article_list.html](blog/templates/blog/article_list.html). Шаблон главной страницы. Отображает список
      статей.
    - [article_detail.html](blog/templates/blog/article_detail.html). Шаблон для просмотра детальной информации
      о статье.
    - [pagination.html](blog/templates/blog/includes/pagination.html). Подшаблон плагинации, включенный в шаблон главной
      страницы.
    - [article_form.html](blog/templates/blog/article_form.html). Шаблон с формой добавления новой статьи
      в базу данных.
    - [article_confirm_delete.html](blog/templates/blog/article_confirm_delete.html). Шаблон для удаления продукта
      из базы данных.
    - [my_tags.py](blog/templatetags/my_tags.py). Кастомный фильтр для обработки путей к медиафайлам Django.
    - [admin.py](blog/admin.py). Конфигурация админ-панели Django. Регистрация моделей (Product, Category, Contact) и
      кастомизация их отображения.
    - [apps.py](blog/apps.py). Конфигурация приложения blog. Определяет имя приложения и метаданные.
    - [models.py](blog/models.py). Модель данных - Article (статья).
    - [tests.py](blog/tests.py). Тесты для проверки функциональности приложения (моделей, представлений).
    - [urls.py](blog/urls.py). Маршруты приложения начинаются с 'blog/'.
    - [views.py](blog/views.py). Для блоговой записи реализован полный CRUD. Также на странице просмотра статей
      применяется фильтрация по флагу публикации и дате создания в порядке убывания. Реализован счетчик просмотра статьи
      при переходе на страницу детального просмотра. Когда количество просмотров достигнет 100, на почту отправляется
      письмо с поздравлениями. Помимо этого пользователя выбрасывает на страницу детального просмотра информации о
      статье при ее успешном редактировании.

4. Приложение [users](users):

   Реализация работы:
    - [login.html](users/templates/login.html). Шаблон формы для входа в личный кабинет.
    - [user_form.html](users/templates/users/user_form.html). Шаблон формы регистрации пользователя.
    - [profile.html](users/templates/users/profile.html). Шаблон формы редактирования профиля.
    - [forms.py](users/forms.py). Пакет, содержащий формы UserRegisterForm (регистрация пользователя), UserProfileForm (
      редактирование профиля).
    - [models.py](users/models.py). Модель данных - User (пользователь).
    - [urls.py](users/urls.py). Маршруты приложения начинаются с 'users/'.
    - [views.py](users/views.py). При создании пользователя на почту отправляется письмо с ссылкой подтверждения.
      Реализована возможность редактирования профиля.
